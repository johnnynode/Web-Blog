### HTTP的三次握手

- 在客户端和服务器进行一个http请求的时候, 在发送和返回的过程中需要建立一个TCP connection的东西
- 在HTTP中是不存在连接这样的概念，只有请求和响应，这些都是数据包，它们需要经过一个传输的通道
- 这个通道就是在TCP中创建的这么一个连接, 这个连接是可以一直保持的, HTTP请求是在这个连接的基础上去发送的
- 在TCP连接上可以发送多个HTTP请求，在不同版本中这个模式是不一样的
    * 在1.0版本，这个连接是在一个HTTP请求创建的时候就创建了一个TCP连接，响应之后，连接立即关闭
    * 在1.1版本，这个连接通过某种方式让连接一直保持，在一个请求响应之后不关闭，后续可以继续使用
    * 保持长连接的好处是减少三次握手的开销，三次握手代表有三次网络传输：客户端发送,服务端返回,客户端再发送
    * 通过三次握手创建了一个TCP连接，之后才能发送HTTP请求
    * 如果保持了TCP连接，第二次HTTP请求就不会有三次握手的开销
    * 在2版本中, TCP连接中的HTTP请求是可以并发的, 同一个用户对同一个服务器发起一个网络请求的时候, 只需要一个TCP连接
- HTTP的三次握手
    * 1 ) 首先客户端要发起一个我要创建连接的一个数据包的请求到服务端
    * 这里面有一个标志位：SYN=1，表示这是一个创建请求的数据包，SYN=1表示SYN占据了第一个标志位，下同
    * 后面会有一个Seq=X，X是一个数字
    * 2 ) 服务端接收到这个数据包之后, 就知道了，我有一个客户要和我创建连接了
    * 之后就会开启一个TCP的socket的端口, 之后返回给客户端：SYN=1,ACK=X+1,Seq=Y 这些信息
    * 3 ) 客户端接收到这些信息后，再发送给服务端：ACK=Y+1,Seq=Z

<div align="center">
    <img width="400" src="./screenshot/2.jpg">
    <br />
    <div style="text-align:center">备注：图片托管于github，请确保网络的可访问性</div>
    <br />
</div>

- 为什么要设计出这么一个三次握手的过程
    * 防止服务端开启一些无用的连接，因为网络传输是有延迟的，传输距离远，而且可能有很多代理服务器
    * 在传输过程中，客户端发起了SYN=1创建连接的请求，服务端直接创建了连接并直接响应给客户端
    * 由于网络的不确定性，数据包丢失了，客户端一直没有接受到服务器的响应, 客户端可能因为超时而关闭
    * 这样客户端会发起另一个创建连接的请求, 如果没有三次握手机制，服务端是不知道的, 前一个连接一直开着因此被浪费
    * 所以需要三次握手来确认这个过程让客户端和服务端能够及时察觉到因网络原因导致通信失败和资源浪费
- 抓包工具推荐：Wireshark
    * Wireshark是一个非常好用的抓包工具
    * 不仅能分析HTTP层面的，而且可以深入传输层和网络层
